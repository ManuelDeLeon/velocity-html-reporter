<body>
  {{> velocity}}
</body>

<template name="velocity">
  <div id="velocityOverlay" class="container" style="display: {{overlayIsVisible}};">
  
    <div class="row">
      <div class="col-xs-3">
      {{> velocityAggregateReports}}
      </div>
      <div class="col-xs-9">
        {{#each reportTree}}
          {{> velocityReports}}
        {{/each}}
      </div>
    </div>

    <h3>Logs
      <a class="display-toggle" data-target="velocityLogs">(show/hide)</a></h3>
    {{> velocityLogs}}
        
    <h3>Test Files
      <a class="display-toggle" data-target="velocityTestFiles"
         href="javascript:void(0);">(show/hide)</a></h3>
    {{> velocityTestFiles}}

  </div>

  <!-- The status widget is the display-toggle circle in the upper-right -->
  <a id="velocity-status-widget"
     class="{{statusWidgetClass}} display-toggle"
     data-target="velocityOverlay"></a>

</template>

<template name="velocityAggregateReports">
  <ul class="nav nav-pills nav-stacked">
    {{#each aggregateReports}}
      <li class={{maybeActive}}><a href="#">
        {{> resultLabel }}
        {{name}}
      </a></li>
    {{/each}}
  </ul>  

  <div class="checkbox">
    <label>
      <input id="hideSuccessful" type="checkbox" {{hideSuccessfulIsChecked}}> Hide succesful tests
    </label>
  </div>

</template>

<template name="velocityReports">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">{{name}}</h3>
    </div>
    <div class="panel-body">
      {{#each this.suites}}
      <h4>{{name}}</h4>
        <table class="table table-hover">
          <thead>
          </thead>
          <tbody>
            {{#each this.results}}
              {{> velocityTestReport}}
            {{/each}}
          </tbody>
        </table>
      {{/each}}
    </div>
  </div>

</template>

<template name="velocityTestReport">
  {{#if reportNotHidden}}
    <tr>
      <td class="result-label">{{> resultLabel }}</td>
      <td>
        <div>
          {{{name}}}  {{! XXX triple-stache allows curly quotes, etc. - worth it? }}
          {{#if failed}}
            <br><br>
            <strong>Type:</strong> {{failureType}} <strong>Message:</strong> {{failureMessage}}
            <br>
            {{#if failureStackTrace}}
              <pre class='stack-trace pre-scrollable'>
                {{failureStackTrace}}
              </pre>
            {{else}}
              No stack trace available.
            {{/if}}
          {{/if}}
        </div>
      </td>
      <td class="time-display">{{time}} ms</td>
    </tr>
  {{/if}}
</template>

<template name='resultLabel'>
  <span class="label {{labelColor result}}">
    <span class="{{glyphiconType result}}"></span>
  </span>
  &nbsp;
</template>

<template name="velocityLogs">
  <table id="velocityLogs" class="table" style="display: {{isVisible}};">
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>Type</th>
        <th>Message</th>
        <th>Framework</th>
      </tr>
    </thead>
    <tbody>
      {{#each logs}}
      {{> velocityLog}}
      {{/each}}
    </tbody>
  </table>
</template>

<template name="velocityLog">
    <tr class="{{result}}">
        <td>{{timestamp}}</td>
        <td>{{type}}</td>
        <td>{{message}}</td>
        <td>{{framework}}</td>
    </tr>
</template>

<template name="velocityTestFiles">
    <table id="velocityTestFiles"
           class="table"
           style="display: {{isVisible}};">
        <thead>
            <tr>
                <th>ID</th>
                <th>Relative Path</th>
                <th>Target Framework</th>
                <th>Last Modified</th>
            </tr>
        </thead>
        <tbody>
            {{#each testFiles}}
            {{> velocityTestFile}}
            {{/each}}
        </tbody>
    </table>
</template>

<template name="velocityTestFile">
    <tr class="{{result}}">
        <td>{{_id}}</td>
        <td>{{relativePath}}</td>
        <td>{{targetFramework}}</td>
        <td>{{lastModified}}</td>
    </tr>
</template>