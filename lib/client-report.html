<body>
  {{> velocity}}
</body>

<template name="velocity">
  <div id="velocityOverlay" class="container" style="display: {{overlayIsVisible}};">
  
    <div class="row">
      <div class="col-xs-3">
      {{> velocityAggregateReports}}
      </div>
      <div class="col-xs-9 reports-pane">
        {{#each frameworks}}
          {{> velocityReports}}
        {{/each}}

        <h3>Logs
          <a class="display-toggle" data-target="velocityLogs">(show/hide)</a></h3>
        {{> velocityLogs}}

        <h3>Test Files
          <a class="display-toggle" data-target="velocityTestFiles"
             href="javascript:void(0);">(show/hide)</a></h3>
        {{> velocityTestFiles}}

        <h3>Mocha iFrame</h3>
        {{> mochaweb}}
      </div>
    </div>

  </div>

  <!-- The status widget is the display-toggle circle in the upper-right -->
  <a id="velocity-status-widget"
     class="{{statusWidgetClass}} display-toggle"
     data-target="velocityOverlay"></a>

</template>

<template name="velocityAggregateReports">
  <h1>Velocity</h1>
  <div class="alert alert-success"> X of X Passed</div>
  <ul class="nav nav-pills nav-stacked">
    {{#each aggregateReports}}
      <li class={{maybeActive}}><a href="#">
        {{> resultLabel }}
        {{name}}
      </a></li>
    {{/each}}
  </ul>  

  <div class="panel panel-default">
    <div class="panel-body">
      <div class="checkbox">
        <label>
          <input id="hideSuccessful" type="checkbox" {{hideSuccessfulIsChecked}}> Hide succesful tests
        </label>
      </div>
    </div>
  </div>

</template>

<template name="velocityReports">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">
        {{> resultLabel result=frameworkStatus}}
        {{name}}
      </h3>
    </div>
    <div class="panel-body framework">
      {{#each suites}}
        {{#if suiteNotHidden}}
          <h4 class="suite {{suiteStatus}}">
            {{suite}}
          </h4>
          <ul class="reports">
            {{#each reports}}
              {{> velocityTestReport}}
            {{/each}}
          </ul>
        {{/if}}
      {{/each}}
    </div>
  </div>
</template>

<template name="velocityTestReport">
  {{#if reportNotHidden}}
  <li>
    <div class="main-result">
    <table class="table table-condensed">
      <tbody>
        <tr>
          <td class="result-label">{{> resultLabel }}</td>
          <td class="test-name">{{{name}}}</td> {{! XXX triple-stache allows curly quotes, etc. - worth it? }}
          <td class="time-display">{{time}} ms</td>
        </tr>
      </tbody>
    </table>

    </div>
    {{#if failed}}
      <div class="failed-test-info">
        <strong>Failed:</strong> {{failureMessage}}
        <br>
        {{#if failureStackTrace}}
          <pre class='stack-trace pre-scrollable'>
            {{failureStackTrace}}
          </pre>
        {{else}}
          No stack trace available.
        {{/if}}
      </div>
    {{/if}}
  </li>
  {{/if}}
</template>

<template name='resultLabel'>
  <span class="label {{labelColor result}}">
    <span class="{{glyphiconType result}}"></span>
  </span>
  &nbsp;
</template>

<template name="velocityLogs">
  <table id="velocityLogs" class="table" style="display: {{isVisible}};">
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>Type</th>
        <th>Message</th>
        <th>Framework</th>
      </tr>
    </thead>
    <tbody>
      {{#each logs}}
      {{> velocityLog}}
      {{/each}}
    </tbody>
  </table>
</template>

<template name="velocityLog">
    <tr class="{{result}}">
        <td>{{timestamp}}</td>
        <td>{{type}}</td>
        <td>{{message}}</td>
        <td>{{framework}}</td>
    </tr>
</template>

<template name="velocityTestFiles">
    <table id="velocityTestFiles"
           class="table"
           style="display: {{isVisible}};">
        <thead>
            <tr>
                <th>ID</th>
                <th>Relative Path</th>
                <th>Target Framework</th>
                <th>Last Modified</th>
            </tr>
        </thead>
        <tbody>
            {{#each testFiles}}
            {{> velocityTestFile}}
            {{/each}}
        </tbody>
    </table>
</template>

<template name="velocityTestFile">
    <tr class="{{result}}">
        <td>{{_id}}</td>
        <td>{{relativePath}}</td>
        <td>{{targetFramework}}</td>
        <td>{{lastModified}}</td>
    </tr>
</template>
